# Pre-commit hooks configuration for terraform-provider-f5distributedcloud
# See https://pre-commit.com for more information
#
# Install: pre-commit install
# Run all: pre-commit run --all-files
# Update:  pre-commit autoupdate
#
# NOTE: These hooks CHECK ONLY and do not auto-fix files.
# All generators must produce valid output that passes these checks.

minimum_pre_commit_version: '3.0.0'
default_stages: [pre-commit]

repos:
  # =============================================================================
  # General file hygiene hooks (CHECK ONLY - no auto-fix)
  # =============================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      # File validation (these are check-only by nature)
      - id: check-yaml
        args: ['--unsafe']  # Allow custom YAML tags
      - id: check-json
      - id: check-toml

      # Security and safety (check-only)
      - id: check-added-large-files
        args: ['--maxkb=1000']
      - id: check-case-conflict
      - id: check-merge-conflict
      - id: detect-private-key

      # Executable permissions (check-only)
      - id: check-executables-have-shebangs
      - id: check-shebang-scripts-are-executable

  # =============================================================================
  # Whitespace checks (CHECK ONLY - custom hooks that don't auto-fix)
  # =============================================================================
  - repo: local
    hooks:
      - id: trailing-whitespace-check
        name: trailing-whitespace (check)
        entry: ./scripts/check-trailing-whitespace.sh
        language: script
        pass_filenames: false

      - id: end-of-file-check
        name: end-of-file-newline (check)
        entry: ./scripts/check-eof-newline.sh
        language: script
        pass_filenames: false

      - id: mixed-line-ending-check
        name: mixed-line-ending (check)
        entry: ./scripts/check-line-endings.sh
        language: script
        pass_filenames: false

  # =============================================================================
  # Go language hooks (using local system tools)
  # =============================================================================
  - repo: local
    hooks:
      - id: golangci-lint
        name: golangci-lint
        entry: golangci-lint run --timeout=5m
        language: system
        types: [go]
        pass_filenames: false

      - id: go-fmt-check
        name: go-fmt (check)
        entry: bash -c 'FILES=$(gofmt -l .); if [ -n "$FILES" ]; then echo "Files not formatted:"; echo "$FILES"; exit 1; fi'
        language: system
        types: [go]
        pass_filenames: false

      - id: go-mod-tidy-check
        name: go-mod-tidy (check)
        entry: bash -c 'cp go.mod go.mod.bak && cp go.sum go.sum.bak && go mod tidy && diff -q go.mod go.mod.bak && diff -q go.sum go.sum.bak; ret=$?; mv go.mod.bak go.mod 2>/dev/null; mv go.sum.bak go.sum 2>/dev/null; exit $ret'
        language: system
        pass_filenames: false
        files: '(\.go$|go\.mod$|go\.sum$)'

      - id: go-vet
        name: go-vet
        entry: go vet ./...
        language: system
        types: [go]
        pass_filenames: false

      - id: go-build
        name: go-build (verify)
        entry: go build ./...
        language: system
        types: [go]
        pass_filenames: false

  # =============================================================================
  # Terraform configuration hooks
  # =============================================================================
  - repo: https://github.com/antonbabenko/pre-commit-terraform
    rev: v1.104.0
    hooks:
      # Format check for Terraform files (check only, no fix)
      - id: terraform_fmt
        name: terraform-fmt (check)
        args:
          - --args=-check
          - --args=-diff

  # =============================================================================
  # Shell script hooks
  # =============================================================================
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.10.0.1
    hooks:
      - id: shellcheck
        name: shellcheck
        args: ['--severity=warning']
        exclude: '^\.specify/'  # Exclude external tooling scripts

  # =============================================================================
  # Security scanning (using detect-secrets with existing baseline)
  # =============================================================================
  - repo: local
    hooks:
      - id: detect-secrets
        name: detect-secrets (secrets detection)
        entry: detect-secrets-hook --baseline .secrets.baseline
        language: system
        pass_filenames: true

# =============================================================================
# CI Configuration
# =============================================================================
# For CI, run: pre-commit run --all-files
# To skip hooks: SKIP=go-build pre-commit run --all-files
